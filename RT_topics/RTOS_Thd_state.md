# Потоки - состояния 

Проведу некоторую черту для прояснения состояний потоков по этой картинке)

<p align="center">
<img src="http://chibios.sourceforge.net/docs3/rt/dot_inline_dotgraph_5.png">
</p>

Количество кружков-состояний насчитывается тут шесть, но можно сразу заметить, что состояния `Start`, `Stop`, `Suspended` нам не интересны, так как, в-основном, работа ведется с потоками, которые работают в бесконечном цикле. Таким образов вызов `chThdCreateStatic()` сразу переводит поток либо в состояние `Ready`, либо в состояние `Running`.

+ Состояние `Running` может быть у одного единственного потока в один момент времени (если говорим про одноядерную систему).
+ Состояние `Ready` сообщает диспетчеру, что нужно добавить поток в очередь на выполнение и как только подойдет время, в зависимости от системы диспетчеризации (Round-Robin / Cooperative) и приоритета, поток начнет выполнение. Таким образом, потоки в состоянии `Ready` ждут своего звездного часа).
+ Состояние `Sleeping` достаточно интересно. Переход в него делается множеством функции. Из тех, что мы рассмотрели, это могут быть `chThdSleep*()` и `chThdSuspend*()`. Также это могут быть функции, в названии которых есть слово `Timeout` и передано время таймаута (не `TIME_IMMEDIATE`). Переход в это состояние сообщает диспетчеру о том, что потоку необходимо заснуть до наступления события, либо истечения промежутка времени. Таким образом функции `chThdSleep*()` и функции с таймаутом можно расценивать близко в плане принципа работы. Важно отметить, что данное состояние присуще системам реального времени и им рекомендовано пользоваться, так как перевод потока в состояние `Sleeping` и ожидание события - это Event Driven (событийный) принцип работы (в противоположнось Polling (опрос)). Таким образом достигается работа многопоточности, а в случае состояния `Sleeping` на все потоки - разгрузка CPU.
+ `Reschedule` переход может происходить в разных случаях, но, в-основном, это вытеснение (Preemption) одного потока другим, либо переход из-за окончания кванта времени (Quantum - Round-Robin).